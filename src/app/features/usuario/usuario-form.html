<app-main-menu></app-main-menu>

<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="h3 mb-0 text-primary">
          <i class="bi bi-person-plus me-2"></i>
          {{ editMode ? 'Editar' : 'Cadastrar' }} Usuário
        </h2>
        <button type="button" class="btn btn-outline-secondary" (click)="voltarParaLista()">
          <i class="bi bi-arrow-left me-2"></i>
          Voltar
        </button>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="needs-validation" novalidate>
        <!-- Informações Básicas -->
        <app-form-card 
          title="Informações Básicas" 
          icon="bi bi-person" 
          headerClass="bg-primary text-white">
          
          <div class="row g-3">
            <div class="col-md-6">
              <app-bootstrap-form-field
                fieldId="nome"
                label="Nome Completo"
                type="text"
                [control]="form.controls['nome']"
                controlName="nome"
                placeholder="Digite o nome completo"
                [required]="true">
              </app-bootstrap-form-field>
            </div>

            <div class="col-md-6">
              <app-bootstrap-form-field
                fieldId="email"
                label="E-mail"
                type="email"
                [control]="form.controls['email']"
                controlName="email"
                placeholder="exemplo@email.com"
                [required]="true">
              </app-bootstrap-form-field>
            </div>
          </div>
        </app-form-card>

        <!-- Segurança -->
        <app-form-card 
          *ngIf="!editMode"
          title="Segurança" 
          icon="bi bi-shield-lock" 
          headerClass="bg-warning text-dark">
          
          <div class="row g-3">
            <div class="col-md-6">
              <app-bootstrap-form-field
                fieldId="senha"
                label="Senha"
                type="password"
                [control]="form.controls['senha']"
                controlName="senha"
                placeholder="Mínimo 6 caracteres"
                [required]="true"
                helpText="A senha deve ter pelo menos 6 caracteres">
              </app-bootstrap-form-field>
            </div>
            
            <div class="col-md-6 d-flex align-items-end">
              <div class="form-check">
                <input 
                  type="checkbox" 
                  class="form-check-input" 
                  id="showPassword"
                  (change)="togglePassword()" />
                <label class="form-check-label" for="showPassword">
                  Mostrar senha
                </label>
              </div>
            </div>
          </div>
        </app-form-card>

        <!-- Configurações -->
        <app-form-card 
          title="Configurações" 
          icon="bi bi-gear" 
          headerClass="bg-info text-white">
          
          <div class="row g-3">
            <div class="col-md-6">
              <app-bootstrap-form-field
                fieldId="role"
                label="Papel"
                type="select"
                [control]="form.controls['role']"
                controlName="role"
                [options]="roles"
                [required]="true">
              </app-bootstrap-form-field>
            </div>

            <div class="col-md-6" *ngIf="editMode">
              <div class="form-check">
                <input 
                  type="checkbox" 
                  class="form-check-input" 
                  id="ativo"
                  formControlName="ativo" />
                <label class="form-check-label" for="ativo">
                  Usuário ativo
                </label>
                <div class="form-text">
                  Usuários inativos não podem acessar o sistema
                </div>
              </div>
            </div>
          </div>
        </app-form-card>

        <!-- Ações do formulário -->
        <div class="d-flex justify-content-between align-items-center">
          <app-bootstrap-button
            variant="outline-secondary"
            text="Voltar"
            icon="bi bi-arrow-left"
            (onClick)="voltarParaLista()">
          </app-bootstrap-button>
          
          <app-bootstrap-button
            type="submit"
            variant="primary"
            text="Salvar"
            icon="bi bi-check-circle"
            [loading]="loading"
            loadingText="Salvando..."
            [disabled]="form.invalid">
          </app-bootstrap-button>
        </div>

        <!-- Mensagens de feedback -->
        <div class="mt-3" *ngIf="error">
          <div class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            {{ error }}
          </div>
        </div>
      </form>
    </div>
  </div>
</div>