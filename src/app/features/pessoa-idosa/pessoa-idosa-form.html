<app-main-menu></app-main-menu>

<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="h3 mb-0 text-primary">
          <i class="bi bi-person-plus me-2"></i>
          {{ editMode ? 'Editar' : 'Cadastrar' }} Pessoa Idosa
        </h2>
        <button type="button" class="btn btn-outline-secondary" (click)="voltarParaLista()">
          <i class="bi bi-arrow-left me-2"></i>
          Voltar
        </button>
      </div>

             <form [formGroup]="form" (ngSubmit)="onSubmit()" class="needs-validation" novalidate>
         <!-- Informações Pessoais -->
         <app-form-card 
           title="Informações Pessoais" 
           icon="bi bi-person" 
           headerClass="bg-primary text-white">
           
                      <div class="row g-3">
             <div class="col-md-6">
               <label for="nome" class="form-label">Nome Completo *</label>
               <input 
                 id="nome"
                 type="text" 
                 class="form-control"
                 formControlName="nome"
                 placeholder="Digite o nome completo"
                 [class.is-invalid]="form.get('nome')?.invalid && form.get('nome')?.touched"
                 required>
               <div class="invalid-feedback" *ngIf="form.get('nome')?.invalid && form.get('nome')?.touched">
                 Nome é obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="dataNascimento" class="form-label">Data de Nascimento *</label>
               <input 
                 id="dataNascimento"
                 type="date" 
                 class="form-control"
                 formControlName="dataNascimento"
                 [class.is-invalid]="form.get('dataNascimento')?.invalid && form.get('dataNascimento')?.touched"
                 required>
               <div class="invalid-feedback" *ngIf="form.get('dataNascimento')?.invalid && form.get('dataNascimento')?.touched">
                 Data de nascimento é obrigatória.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="estadoCivil" class="form-label">Estado Civil *</label>
               <select 
                 id="estadoCivil"
                 class="form-select"
                 formControlName="estadoCivil"
                 [class.is-invalid]="form.get('estadoCivil')?.invalid && form.get('estadoCivil')?.touched"
                 required>
                 <option value="">Selecione o estado civil</option>
                 <option *ngFor="let estado of estadosCivis" [value]="estado">
                   {{ estado }}
                 </option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('estadoCivil')?.invalid && form.get('estadoCivil')?.touched">
                 Estado civil é obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="cpf" class="form-label">CPF *</label>
               <input 
                 id="cpf"
                 type="text" 
                 class="form-control"
                 formControlName="cpf"
                 placeholder="000.000.000-00"
                 maxlength="14"
                 inputmode="numeric"
                 [class.is-invalid]="form.get('cpf')?.invalid && form.get('cpf')?.touched"
                 required>
               <div class="invalid-feedback" *ngIf="form.get('cpf')?.invalid && form.get('cpf')?.touched">
                 CPF válido é obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="rg" class="form-label">RG</label>
               <input 
                 id="rg"
                 type="text" 
                 class="form-control"
                 formControlName="rg"
                 placeholder="00.000.000-0"
                 maxlength="12"
                 inputmode="numeric"
                 [class.is-invalid]="form.get('rg')?.invalid && form.get('rg')?.touched">
               <div class="invalid-feedback" *ngIf="form.get('rg')?.invalid && form.get('rg')?.touched">
                 RG inválido.
               </div>
             </div>
 
             <div class="col-md-6">
               <label for="orgaoEmissor" class="form-label">Órgão Emissor (RG) *</label>
               <input 
                 id="orgaoEmissor"
                 type="text" 
                 class="form-control"
                 formControlName="orgaoEmissor"
                 placeholder="Ex: SSP, DETRAN"
                 [class.is-invalid]="form.get('orgaoEmissor')?.invalid && form.get('orgaoEmissor')?.touched"
                 required>
               <div class="invalid-feedback" *ngIf="form.get('orgaoEmissor')?.invalid && form.get('orgaoEmissor')?.touched">
                 Órgão emissor é obrigatório.
               </div>
             </div>
 
             <div class="col-md-6">
               <label for="telefone" class="form-label">Telefone/Celular *</label>
               <input 
                 id="telefone"
                 type="text" 
                 class="form-control"
                 formControlName="telefone"
                 placeholder="(00) 00000-0000"
                 maxlength="15"
                 inputmode="numeric"
                 [class.is-invalid]="form.get('telefone')?.invalid && form.get('telefone')?.touched"
                 required>
               <div class="invalid-feedback" *ngIf="form.get('telefone')?.invalid && form.get('telefone')?.touched">
                 Telefone válido é obrigatório.
               </div>
             </div>
 
             <div class="col-md-6">
               <label for="naturalidade" class="form-label">Naturalidade *</label>
               <input 
                 id="naturalidade"
                 type="text" 
                 class="form-control"
                 formControlName="naturalidade"
                 placeholder="Digite a naturalidade"
                 [class.is-invalid]="form.get('naturalidade')?.invalid && form.get('naturalidade')?.touched"
                 required>
               <div class="invalid-feedback" *ngIf="form.get('naturalidade')?.invalid && form.get('naturalidade')?.touched">
                 Naturalidade é obrigatória.
               </div>
             </div>
           </div>
        </app-form-card>
        
                 <!-- Informações Adicionais -->
         <app-form-card 
           title="Informações Adicionais" 
           icon="bi bi-info-circle" 
           headerClass="bg-info text-white">
           
                      <div class="row g-3">
             <div class="col-md-6">
               <label for="prontuarioSaude" class="form-label">Prontuário de Saúde *</label>
               <input 
                 id="prontuarioSaude"
                 type="text" 
                 class="form-control"
                 formControlName="prontuarioSaude"
                 placeholder="Digite o prontuário"
                 [class.is-invalid]="form.get('prontuarioSaude')?.invalid && form.get('prontuarioSaude')?.touched"
                 required>
               <div class="invalid-feedback" *ngIf="form.get('prontuarioSaude')?.invalid && form.get('prontuarioSaude')?.touched">
                 Prontuário de saúde é obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="religiao" class="form-label">Religião *</label>
               <input 
                 id="religiao"
                 type="text" 
                 class="form-control"
                 formControlName="religiao"
                 placeholder="Digite a religião"
                 [class.is-invalid]="form.get('religiao')?.invalid && form.get('religiao')?.touched"
                 required>
               <div class="invalid-feedback" *ngIf="form.get('religiao')?.invalid && form.get('religiao')?.touched">
                 Religião é obrigatória.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="situacaoOcupacional" class="form-label">Situação Ocupacional *</label>
               <select 
                 id="situacaoOcupacional"
                 class="form-select"
                 formControlName="situacaoOcupacional"
                 [class.is-invalid]="form.get('situacaoOcupacional')?.invalid && form.get('situacaoOcupacional')?.touched"
                 required>
                 <option value="">Selecione a situação ocupacional</option>
                 <option *ngFor="let situacao of situacoesOcupacionais" [value]="situacao">
                   {{ situacao }}
                 </option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('situacaoOcupacional')?.invalid && form.get('situacaoOcupacional')?.touched">
                 Situação ocupacional é obrigatória.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="aposentado" class="form-label">Aposentado? *</label>
               <select 
                 id="aposentado"
                 class="form-select"
                 formControlName="aposentado"
                 [class.is-invalid]="form.get('aposentado')?.invalid && form.get('aposentado')?.touched"
                 required>
                 <option value="">Selecione uma opção</option>
                 <option *ngFor="let aposentado of aposentados" [value]="aposentado">
                   {{ aposentado }}
                 </option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('aposentado')?.invalid && form.get('aposentado')?.touched">
                 Campo obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="renda" class="form-label">Renda *</label>
               <select 
                 id="renda"
                 class="form-select"
                 formControlName="renda"
                 [class.is-invalid]="form.get('renda')?.invalid && form.get('renda')?.touched"
                 required>
                 <option value="">Selecione a renda</option>
                 <option *ngFor="let renda of rendas" [value]="renda">
                   {{ renda }}
                 </option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('renda')?.invalid && form.get('renda')?.touched">
                 Renda é obrigatória.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="aposentadoConsegueSeManterComSuaRenda" class="form-label">Se mantém com a renda? *</label>
               <select 
                 id="aposentadoConsegueSeManterComSuaRenda"
                 class="form-select"
                 formControlName="aposentadoConsegueSeManterComSuaRenda"
                 [class.is-invalid]="form.get('aposentadoConsegueSeManterComSuaRenda')?.invalid && form.get('aposentadoConsegueSeManterComSuaRenda')?.touched"
                 required>
                 <option value="">Selecione uma opção</option>
                 <option [value]="true">Sim</option>
                 <option [value]="false">Não</option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('aposentadoConsegueSeManterComSuaRenda')?.invalid && form.get('aposentadoConsegueSeManterComSuaRenda')?.touched">
                 Campo obrigatório.
               </div>
             </div>
             
             <div class="col-12">
               <label for="comoComplementa" class="form-label">Como complementa a renda?</label>
               <textarea 
                 id="comoComplementa"
                 class="form-control"
                 formControlName="comoComplementa"
                 placeholder="Descreva como complementa a renda"
                 rows="3"
                 [disabled]="form.get('aposentadoConsegueSeManterComSuaRenda')?.value !== false"
                 [class.is-invalid]="form.get('comoComplementa')?.invalid && form.get('comoComplementa')?.touched">
               </textarea>
               <div class="invalid-feedback" *ngIf="form.get('comoComplementa')?.invalid && form.get('comoComplementa')?.touched">
                 Campo obrigatório quando não se mantém com a renda.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="beneficio" class="form-label">Recebe algum Benefício? *</label>
               <select 
                 id="beneficio"
                 class="form-select"
                 formControlName="beneficio"
                 [class.is-invalid]="form.get('beneficio')?.invalid && form.get('beneficio')?.touched"
                 required>
                 <option value="">Selecione o benefício</option>
                 <option *ngFor="let beneficio of beneficios" [value]="beneficio">
                   {{ beneficio }}
                 </option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('beneficio')?.invalid && form.get('beneficio')?.touched">
                 Benefício é obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="alfabetizado" class="form-label">Alfabetizado *</label>
               <select 
                 id="alfabetizado"
                 class="form-select"
                 formControlName="alfabetizado"
                 [class.is-invalid]="form.get('alfabetizado')?.invalid && form.get('alfabetizado')?.touched"
                 required>
                 <option value="">Selecione uma opção</option>
                 <option [value]="true">Sim</option>
                 <option [value]="false">Não</option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('alfabetizado')?.invalid && form.get('alfabetizado')?.touched">
                 Campo obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="nivelSerieAtualConcluido" class="form-label">Nível e Série Atual e Concluído *</label>
               <select 
                 id="nivelSerieAtualConcluido"
                 class="form-select"
                 formControlName="nivelSerieAtualConcluido"
                 [class.is-invalid]="form.get('nivelSerieAtualConcluido')?.invalid && form.get('nivelSerieAtualConcluido')?.touched"
                 required>
                 <option value="">Selecione o nível</option>
                 <option *ngFor="let nivel of niveisSerie" [value]="nivel">
                   {{ nivel }}
                 </option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('nivelSerieAtualConcluido')?.invalid && form.get('nivelSerieAtualConcluido')?.touched">
                 Nível é obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="cursosTecnicoFormacaoProfissional" class="form-label">Curso Técnico e Formação Profissional *</label>
               <select 
                 id="cursosTecnicoFormacaoProfissional"
                 class="form-select"
                 formControlName="cursosTecnicoFormacaoProfissional"
                 [class.is-invalid]="form.get('cursosTecnicoFormacaoProfissional')?.invalid && form.get('cursosTecnicoFormacaoProfissional')?.touched"
                 required>
                 <option value="">Selecione o curso</option>
                 <option *ngFor="let curso of cursosFormacao" [value]="curso">
                   {{ curso }}
                 </option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('cursosTecnicoFormacaoProfissional')?.invalid && form.get('cursosTecnicoFormacaoProfissional')?.touched">
                 Curso é obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="estudaAtualmente" class="form-label">Estuda atualmente? *</label>
               <select 
                 id="estudaAtualmente"
                 class="form-select"
                 formControlName="estudaAtualmente"
                 [class.is-invalid]="form.get('estudaAtualmente')?.invalid && form.get('estudaAtualmente')?.touched"
                 required>
                 <option value="">Selecione uma opção</option>
                 <option [value]="true">Sim</option>
                 <option [value]="false">Não</option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('estudaAtualmente')?.invalid && form.get('estudaAtualmente')?.touched">
                 Campo obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="deficiencia" class="form-label">Possui alguma deficiência? *</label>
               <select 
                 id="deficiencia"
                 class="form-select"
                 formControlName="deficiencia"
                 [class.is-invalid]="form.get('deficiencia')?.invalid && form.get('deficiencia')?.touched"
                 required>
                 <option value="">Selecione a deficiência</option>
                 <option *ngFor="let deficiencia of deficiencias" [value]="deficiencia">
                   {{ deficiencia }}
                 </option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('deficiencia')?.invalid && form.get('deficiencia')?.touched">
                 Deficiência é obrigatória.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="problemaDeSaude" class="form-label">Possui problemas de Saúde? *</label>
               <select 
                 id="problemaDeSaude"
                 class="form-select"
                 formControlName="problemaDeSaude"
                 [class.is-invalid]="form.get('problemaDeSaude')?.invalid && form.get('problemaDeSaude')?.touched"
                 required>
                 <option value="">Selecione o problema</option>
                 <option *ngFor="let problema of problemasSaude" [value]="problema">
                   {{ problema }}
                 </option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('problemaDeSaude')?.invalid && form.get('problemaDeSaude')?.touched">
                 Problema de saúde é obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="fazAlgumTratamento" class="form-label">Faz algum tratamento? *</label>
               <select 
                 id="fazAlgumTratamento"
                 class="form-select"
                 formControlName="fazAlgumTratamento"
                 [class.is-invalid]="form.get('fazAlgumTratamento')?.invalid && form.get('fazAlgumTratamento')?.touched"
                 required>
                 <option value="">Selecione uma opção</option>
                 <option [value]="true">Sim</option>
                 <option [value]="false">Não</option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('fazAlgumTratamento')?.invalid && form.get('fazAlgumTratamento')?.touched">
                 Campo obrigatório.
               </div>
             </div>
             
                            <div class="col-md-6">
                 <label for="fazAlgumTratamentoOnde" class="form-label">Onde faz o tratamento?</label>
                 <input 
                   id="fazAlgumTratamentoOnde"
                   type="text" 
                   class="form-control"
                   formControlName="fazAlgumTratamentoOnde"
                   placeholder="Digite onde faz o tratamento"
                   [disabled]="form.get('fazAlgumTratamento')?.value !== true"
                   [class.is-invalid]="form.get('fazAlgumTratamentoOnde')?.invalid && form.get('fazAlgumTratamentoOnde')?.touched">
                 <div class="invalid-feedback" *ngIf="form.get('fazAlgumTratamentoOnde')?.invalid && form.get('fazAlgumTratamentoOnde')?.touched">
                   Campo obrigatório quando faz tratamento.
                 </div>
               </div>
             
             <div class="col-md-6">
               <label for="usaMedicamentoControlado" class="form-label">Usa medicamento controlado? *</label>
               <select 
                 id="usaMedicamentoControlado"
                 class="form-select"
                 formControlName="usaMedicamentoControlado"
                 [class.is-invalid]="form.get('usaMedicamentoControlado')?.invalid && form.get('usaMedicamentoControlado')?.touched"
                 required>
                 <option value="">Selecione uma opção</option>
                 <option [value]="true">Sim</option>
                 <option [value]="false">Não</option>
               </select>
               <div class="invalid-feedback" *ngIf="form.get('usaMedicamentoControlado')?.invalid && form.get('usaMedicamentoControlado')?.touched">
                 Campo obrigatório.
               </div>
             </div>
             
                            <div class="col-md-6">
                 <label for="usaRecursosUbsLocal" class="form-label">Usa recursos da UBS local? *</label>
                 <select 
                   id="usaRecursosUbsLocal"
                   class="form-select"
                   formControlName="usaRecursosUbsLocal"
                   [class.is-invalid]="form.get('usaRecursosUbsLocal')?.invalid && form.get('usaRecursosUbsLocal')?.touched"
                   required>
                   <option value="">Selecione uma opção</option>
                   <option [value]="true">Sim</option>
                   <option [value]="false">Não</option>
                 </select>
                 <div class="invalid-feedback" *ngIf="form.get('usaRecursosUbsLocal')?.invalid && form.get('usaRecursosUbsLocal')?.touched">
                   Campo obrigatório.
                 </div>
               </div>
             
             <div class="col-12">
               <label for="trabalhoPastoralOuSocial" class="form-label">Faz algum trabalho pastoral ou social na sua Igreja ou no seu bairro? *</label>
               <textarea 
                 id="trabalhoPastoralOuSocial"
                 class="form-control"
                 formControlName="trabalhoPastoralOuSocial"
                 placeholder="Descreva o trabalho pastoral ou social"
                 rows="3"
                 [class.is-invalid]="form.get('trabalhoPastoralOuSocial')?.invalid && form.get('trabalhoPastoralOuSocial')?.touched"
                 required>
               </textarea>
               <div class="invalid-feedback" *ngIf="form.get('trabalhoPastoralOuSocial')?.invalid && form.get('trabalhoPastoralOuSocial')?.touched">
                 Campo obrigatório.
               </div>
             </div>
             
                            <div class="col-12">
                 <label for="atividadeNaComunidadeSagradaFamilia" class="form-label">Desenvolve alguma atividade na Comunidade Sagrada Família? *</label>
                 <textarea 
                   id="atividadeNaComunidadeSagradaFamilia"
                   class="form-control"
                   formControlName="atividadeNaComunidadeSagradaFamilia"
                   placeholder="Descreva a atividade na comunidade"
                   rows="3"
                   [class.is-invalid]="form.get('atividadeNaComunidadeSagradaFamilia')?.invalid && form.get('atividadeNaComunidadeSagradaFamilia')?.touched"
                   required>
                 </textarea>
                 <div class="invalid-feedback" *ngIf="form.get('atividadeNaComunidadeSagradaFamilia')?.invalid && form.get('atividadeNaComunidadeSagradaFamilia')?.touched">
                   Campo obrigatório.
                 </div>
               </div>
             
             <div class="col-12">
               <label for="trabalhoVoluntario" class="form-label">Deseja desenvolver algum trabalho voluntário? *</label>
               <textarea 
                 id="trabalhoVoluntario"
                 class="form-control"
                 formControlName="trabalhoVoluntario"
                 placeholder="Descreva o trabalho voluntário desejado"
                 rows="3"
                 [class.is-invalid]="form.get('trabalhoVoluntario')?.invalid && form.get('trabalhoVoluntario')?.touched"
                 required>
               </textarea>
               <div class="invalid-feedback" *ngIf="form.get('trabalhoVoluntario')?.invalid && form.get('trabalhoVoluntario')?.touched">
                 Campo obrigatório.
               </div>
             </div>
             
             <div class="col-md-6">
               <label for="trabalhoVoluntarioOnde" class="form-label">Onde gostaria de desenvolver o trabalho voluntário?</label>
               <input 
                 id="trabalhoVoluntarioOnde"
                 type="text" 
                 class="form-control"
                 formControlName="trabalhoVoluntarioOnde"
                 placeholder="Digite onde gostaria de trabalhar"
                 [disabled]="!form.get('trabalhoVoluntario')?.value || form.get('trabalhoVoluntario')?.value.trim() === ''"
                 [class.is-invalid]="form.get('trabalhoVoluntarioOnde')?.invalid && form.get('trabalhoVoluntarioOnde')?.touched">
               <div class="invalid-feedback" *ngIf="form.get('trabalhoVoluntarioOnde')?.invalid && form.get('trabalhoVoluntarioOnde')?.touched">
                 Campo obrigatório quando deseja desenvolver trabalho voluntário.
               </div>
             </div>
             
             <div class="col-12">
               <label for="observacao" class="form-label">Observação</label>
               <textarea 
                 id="observacao"
                 class="form-control"
                 formControlName="observacao"
                 placeholder="Observações adicionais"
                 rows="3">
               </textarea>
             </div>
             
             <div class="col-12">
               <label for="historicoFamiliarSocial" class="form-label">Histórico familiar e social</label>
               <textarea 
                 id="historicoFamiliarSocial"
                 class="form-control"
                 formControlName="historicoFamiliarSocial"
                 placeholder="Descreva o histórico familiar e social"
                 rows="4">
               </textarea>
             </div>
           </div>
        </app-form-card>
        
        <!-- Endereço -->
        <app-form-card 
          title="Endereço" 
          icon="bi bi-geo-alt" 
          headerClass="bg-success text-white">
          
          <ng-container *ngIf="form.get('endereco') as enderecoForm">
            <app-endereco-form [form]="enderecoForm" (valueChanges)="onEnderecoChange($event)"></app-endereco-form>
          </ng-container>
        </app-form-card>

        <!-- Dependentes -->
        <app-form-card 
          title="Dependentes" 
          icon="bi bi-people" 
          headerClass="bg-warning text-dark">
          
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="mb-0">Lista de Dependentes</h6>
            <button type="button" class="btn btn-primary btn-sm" (click)="abrirNovoDependente()">
              <i class="bi bi-plus-circle me-1"></i>
              Adicionar Dependente
            </button>
          </div>
          
          <div *ngIf="dependentes.length === 0" class="text-center py-4">
            <div class="text-muted mb-3">
              <i class="bi bi-people" style="font-size: 3rem;"></i>
            </div>
            <h6 class="text-muted">Nenhum dependente cadastrado</h6>
            <small class="text-muted">Clique no botão acima para adicionar um dependente</small>
          </div>
          
          <div *ngIf="dependentes.length > 0" class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Nome</th>
                  <th>Data Nasc.</th>
                  <th>Parentesco</th>
                  <th>Status</th>
                  <th class="text-center">Ações</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let dep of dependentes; let i = index">
                  <td>{{ dep.nome }}</td>
                  <td>{{ dep.dataNascimento | date:'dd/MM/yyyy' }}</td>
                  <td>{{ dep.parentesco }}</td>
                  <td>
                    <span class="badge" [class.bg-success]="dep.ativo" [class.bg-secondary]="!dep.ativo">
                      {{ dep.ativo ? 'Ativo' : 'Inativo' }}
                    </span>
                  </td>
                  <td class="text-center">
                    <div class="btn-group btn-group-sm" role="group">
                      <button type="button" class="btn btn-outline-primary" (click)="editarDependente(i)" title="Editar">
                        <i class="bi bi-pencil me-1"></i>
                        Editar
                      </button>
                      <button type="button" class="btn btn-outline-danger" (click)="confirmarRemoverDependente(i)" title="Remover">
                        <i class="bi bi-trash me-1"></i>
                        Remover
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Formulário de dependente inline -->
          <div *ngIf="showDependenteForm" class="dependente-form-inline">
            <div class="card border-primary">
              <div class="card-header bg-primary text-white">
                <h6 class="mb-0">
                  <i class="bi bi-person-plus me-2"></i>
                  {{ dependenteEditValue ? 'Editar' : 'Novo' }} Dependente
                </h6>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Nome Completo *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      placeholder="Digite o nome completo"
                      [(ngModel)]="novoDependente.nome"
                      name="dependenteNome">
                  </div>
                  
                  <div class="col-md-6">
                    <label class="form-label">Data de Nascimento *</label>
                    <input 
                      type="date" 
                      class="form-control" 
                      [(ngModel)]="novoDependente.dataNascimento"
                      name="dependenteDataNasc">
                  </div>
                  
                  <div class="col-md-6">
                    <label class="form-label">Parentesco *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      placeholder="Ex: Filho, Neto, etc."
                      [(ngModel)]="novoDependente.parentesco"
                      name="dependenteParentesco">
                  </div>
                  
                  <div class="col-md-6">
                    <div class="form-check mt-4">
                      <input 
                        class="form-check-input" 
                        type="checkbox" 
                        [(ngModel)]="novoDependente.ativo"
                        name="dependenteAtivo">
                      <label class="form-check-label">
                        Dependente ativo
                      </label>
                    </div>
                  </div>
                </div>
                
                <div class="d-flex gap-2 mt-3">
                  <button type="button" class="btn btn-primary" (click)="salvarDependente()">
                    <i class="bi bi-check-circle me-2"></i>
                    Salvar
                  </button>
                  <button type="button" class="btn btn-secondary" (click)="cancelarDependente()">
                    <i class="bi bi-x-circle me-2"></i>
                    Cancelar
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Modal de confirmação -->
          <app-modal
            [show]="showRemoveModal"
            title="Remover dependente"
            message="Tem certeza que deseja remover este dependente?"
            confirmText="Sim"
            cancelText="Não"
            (confirm)="removerDependente()"
            (cancel)="cancelarRemoverDependente()">
          </app-modal>
        </app-form-card>

        <!-- Anexos -->
        <app-form-card 
          title="Documentos e Anexos" 
          icon="bi bi-paperclip" 
          headerClass="bg-secondary text-white">
          
          <app-anexo-form 
            #anexoForm
            [anexos]="anexos"
            (upload)="onUploadAnexo($event)"
            (removerAnexo)="onRemoverAnexo($event)"
            (baixarAnexo)="onBaixarAnexo($event)">
          </app-anexo-form>
        </app-form-card>

        <!-- Ações do formulário -->
        <div class="d-flex justify-content-between align-items-center">
          <button type="button" class="btn btn-secondary" (click)="voltarParaLista()">
            <i class="bi bi-arrow-left me-2"></i>
            Voltar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="form.invalid || loading">
            <span *ngIf="!loading">
              <i class="bi bi-check-circle me-2"></i>
              Salvar
            </span>
            <span *ngIf="loading" class="d-flex align-items-center">
              <div class="spinner-border spinner-border-sm me-2" role="status">
                <span class="visually-hidden">Carregando...</span>
              </div>
              Salvando...
            </span>
          </button>
        </div>
        
        <!-- Mensagens de feedback -->
        <div class="mt-3" *ngIf="error">
          <div class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            {{ error }}
          </div>
        </div>
      </form>
    </div>
  </div>
</div>