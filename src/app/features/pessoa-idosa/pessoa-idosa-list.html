<app-main-menu></app-main-menu>
<div class="pessoas-list-container">
  <h2>Pessoas Idosas Cadastradas</h2>
  <button (click)="navigate('/pessoa-idosa/novo')" class="button-add">Adicionar Pessoa</button>
  <div class="filtros-container">
    <label>
      Nome
      <input placeholder="Nome" (input)="setFiltroNome(getValue($event))" />
    </label>
    <label>
      Data Nasc.
      <input type="date" (input)="setFiltroDataNascimento(getValue($event))" />
    </label>
    <label>
      Estado Civil
      <select (change)="setFiltroEstadoCivil(getValue($event))">
        <option value="">Todos</option>
        <option *ngFor="let ec of estadosCivis" [value]="ec">{{ ec }}</option>
      </select>
    </label>
    <label>
      CPF
      <input placeholder="CPF" (input)="setFiltroCpf(getValue($event))" />
    </label>
    <label>
      RG
      <input placeholder="RG" (input)="setFiltroRg(getValue($event))" />
    </label>
    <label>
      CEP
      <input placeholder="CEP" (input)="setFiltroCep(getValue($event))" />
    </label>
    <div class="filtros-avancados-container">
      <label>
        Alfabetizado
        <input type="checkbox" (change)="setFiltroAlfabetizado(getChecked($event))" />
      </label>
      <label>
        Estuda Atualmente
        <input type="checkbox" (change)="setFiltroEstudaAtualmente(getChecked($event))" />
      </label>
      <label>
        Nível/Série Atual
        <input (input)="setFiltroNivelSerie(getValue($event))" />
      </label>
      <label>
        Curso Técnico/Formação
        <input (input)="setFiltroCursoFormacao(getValue($event))" />
      </label>
      <label>
        Benefício
        <input (input)="setFiltroBeneficio(getValue($event))" />
      </label>
      <label>
        Situação Ocupacional
        <input (input)="setFiltroSituacaoOcupacional(getValue($event))" />
      </label>
      <label>
        Problema de Saúde
        <input (input)="setFiltroProblemaDeSaude(getValue($event))" />
      </label>
      <label>
        Aposentado
        <input (input)="setFiltroAposentado(getValue($event))" />
      </label>
      <label>
        Moradia
        <input (input)="setFiltroMoradia(getValue($event))" />
      </label>
      <label>
        Deficiência
        <input (input)="setFiltroDeficiencia(getValue($event))" />
      </label>
    </div>
    <label>
      Ativo?
      <select (change)="setFiltroAtivo(getValue($event))">
        <option value="">Todos</option>
        <option value="ativo">Ativo</option>
        <option value="inativo">Inativo</option>
      </select>
    </label>
    <label class="page-size-label">
      Exibir:
      <select (change)="setPageSize(+getValue($event))">
        <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size === -1 ? 'Todos' : size }}</option>
      </select>
    </label>
    <button (click)="exportarPdf()" class="exportar-pdf">Exportar PDF</button>
  </div>
  <div *ngIf="loading" class="loading">Carregando...</div>
  <table *ngIf="!loading && pessoas.length > 0; else semRegistros">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Data de Nascimento</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let pessoa of pessoasFiltradas">
        <td>{{ pessoa.nome }}</td>
        <td>{{ pessoa.dataNascimento | date:'dd/MM/yyyy' }}</td>
        <td>
          <span [class.ativo]="pessoa.ativo" [class.inativo]="!pessoa.ativo">
            {{ pessoa.ativo ? 'Ativo' : 'Inativo' }}
          </span>
        </td>
        <td>
          <button (click)="editar(pessoa.id)">Editar</button>
          <button (click)="inativar(pessoa.id)" [disabled]="!pessoa.ativo">Inativar</button>
        </td>
      </tr>
    </tbody>
  </table>
  <div class="paginacao" *ngIf="!loading && pessoas.length > 0">
    <ng-container *ngIf="pageSize > 0 && total > pageSize">
      <button (click)="setPageIndex(pageIndex - 1)" [disabled]="pageIndex === 0">Anterior</button>
      <span>Página {{ pageIndex + 1 }} de {{ math.ceil(total / pageSize) }}</span>
      <button (click)="setPageIndex(pageIndex + 1)" [disabled]="(pageIndex + 1) * pageSize >= total">Próxima</button>
    </ng-container>
  </div>
  <ng-template #semRegistros>
    <div class="sem-registros">Nenhuma pessoa idosa cadastrada.</div>
  </ng-template>
</div>