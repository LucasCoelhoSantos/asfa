<app-main-menu></app-main-menu>

<div class="pessoas-list-container">
  <div class="header-section">
    <div class="header-content">
      <h1>Pessoas Idosas Cadastradas</h1>
      <p class="subtitle">Gerencie as pessoas idosas cadastradas no sistema</p>
    </div>
    <button class="button-add" (click)="navigate('/pessoa-idosa/novo')">
      Adicionar Pessoa
    </button>
  </div>
  
  <div class="filtros-container">
    <div class="filtros-header">
      <h3>Filtros de Pesquisa</h3>
    </div>
    
    <!-- Filtros B√°sicos -->
    <div class="filtros-section">
      <h4>Informa√ß√µes B√°sicas</h4>
      <div class="filtros-grid">
        <div class="filtro-item">
          <label>Nome</label>
          <input placeholder="Nome" (input)="setFiltroNome(getValue($event))" />
        </div>
        <div class="filtro-item">
          <label>Data Nasc.</label>
          <input type="date" (input)="setFiltroDataNascimento(getValue($event))" />
        </div>
        <div class="filtro-item">
          <label>Estado Civil</label>
          <select (change)="setFiltroEstadoCivil(getValue($event))">
            <option value="">Todos</option>
            <option *ngFor="let ec of estadosCivis" [value]="ec">{{ ec }}</option>
          </select>
        </div>
        <div class="filtro-item">
          <label>CPF</label>
          <input placeholder="000.000.000-00" appMask="cpf" (input)="setFiltroCpf(getValue($event))" />
        </div>
        <div class="filtro-item">
          <label>RG</label>
          <input placeholder="00.000.000-0" appMask="rg" (input)="setFiltroRg(getValue($event))" />
        </div>
        <div class="filtro-item">
          <label>CEP</label>
          <input placeholder="00000-000" appMask="cep" (input)="setFiltroCep(getValue($event))" />
        </div>
      </div>
    </div>
    
    <!-- Filtros Avan√ßados -->
    <div class="filtros-section">
      <h4>Informa√ß√µes Adicionais</h4>
      <div class="filtros-grid">
        <div class="filtro-item checkbox-item">
          <label>
            <input type="checkbox" (change)="setFiltroAlfabetizado(getChecked($event))" />
            <span>Alfabetizado</span>
          </label>
        </div>
        <div class="filtro-item checkbox-item">
          <label>
            <input type="checkbox" (change)="setFiltroEstudaAtualmente(getChecked($event))" />
            <span>Estuda Atualmente</span>
          </label>
        </div>
        <div class="filtro-item">
          <label>N√≠vel/S√©rie Atual</label>
          <select (change)="setFiltroNivelSerie(getValue($event))">
            <option value="">Todos</option>
            <option *ngFor="let nivel of niveisSerie" [value]="nivel">{{ nivel }}</option>
          </select>
        </div>
        <div class="filtro-item">
          <label>Curso T√©cnico/Forma√ß√£o</label>
          <select (change)="setFiltroCursoFormacao(getValue($event))">
            <option value="">Todos</option>
            <option *ngFor="let curso of cursosFormacao" [value]="curso">{{ curso }}</option>
          </select>
        </div>
        <div class="filtro-item">
          <label>Benef√≠cio</label>
          <select (change)="setFiltroBeneficio(getValue($event))">
            <option value="">Todos</option>
            <option *ngFor="let beneficio of beneficios" [value]="beneficio">{{ beneficio }}</option>
          </select>
        </div>
        <div class="filtro-item">
          <label>Situa√ß√£o Ocupacional</label>
          <select (change)="setFiltroSituacaoOcupacional(getValue($event))">
            <option value="">Todos</option>
            <option *ngFor="let situacao of situacoesOcupacionais" [value]="situacao">{{ situacao }}</option>
          </select>
        </div>
        <div class="filtro-item">
          <label>Problema de Sa√∫de</label>
          <select (change)="setFiltroProblemaDeSaude(getValue($event))">
            <option value="">Todos</option>
            <option *ngFor="let problema of problemasSaude" [value]="problema">{{ problema }}</option>
          </select>
        </div>
        <div class="filtro-item">
          <label>Aposentado</label>
          <select (change)="setFiltroAposentado(getValue($event))">
            <option value="">Todos</option>
            <option *ngFor="let aposentado of aposentados" [value]="aposentado">{{ aposentado }}</option>
          </select>
        </div>
        <div class="filtro-item">
          <label>Moradia</label>
          <select (change)="setFiltroMoradia(getValue($event))">
            <option value="">Todos</option>
            <option *ngFor="let moradia of moradias" [value]="moradia">{{ moradia }}</option>
          </select>
        </div>
        <div class="filtro-item">
          <label>Defici√™ncia</label>
          <select (change)="setFiltroDeficiencia(getValue($event))">
            <option value="">Todos</option>
            <option *ngFor="let deficiencia of deficiencias" [value]="deficiencia">{{ deficiencia }}</option>
          </select>
        </div>
      </div>
    </div>
    
    <!-- Controles de Exibi√ß√£o -->
    <div class="filtros-section">
      <h4>Controles</h4>
      <div class="controles-grid">
        <div class="filtro-item">
          <label>Status</label>
          <select (change)="setFiltroAtivo(getValue($event))">
            <option value="">Todos</option>
            <option value="ativo">Ativo</option>
            <option value="inativo">Inativo</option>
          </select>
        </div>
        <div class="filtro-item">
          <label>Itens por P√°gina</label>
          <select (change)="setPageSize(+getValue($event))">
            <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size === -1 ? 'Todos' : size }}</option>
          </select>
        </div>
        <div class="filtro-item">
          <button (click)="exportarPdf()" class="exportar-pdf">Exportar PDF</button>
        </div>
      </div>
      
      <!-- Bot√µes de A√ß√£o -->
      <div class="acoes-filtros">
        <button (click)="buscar()" class="btn-buscar">
          <span class="icon">üîç</span>
          Buscar
        </button>
        <button (click)="limparFiltros()" class="btn-limpar">
          <span class="icon">üóëÔ∏è</span>
          Limpar Filtros
        </button>
      </div>
    </div>
  </div>
  
  <ng-container *ngIf="loading$ | async; else content">
    <app-table-skeleton [rows]="5"></app-table-skeleton>
  </ng-container>
  
  <ng-template #content>
    <ng-container *ngIf="pessoas$ | async as resultado">
      <table *ngIf="resultado.pessoas.length > 0; else semRegistros">
        <thead>
          <tr>
            <th>Nome</th>
            <th>CPF</th>
            <th>Telefone</th>
            <th>RG</th>
            <th>CEP</th>
            <th>Data de Nascimento</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let pessoa of resultado.pessoas">
            <td>{{ pessoa.nome }}</td>
            <td>{{ pessoa.cpf | cpf }}</td>
            <td>{{ pessoa.telefone | telefone }}</td>
            <td>{{ pessoa.rg | rg }}</td>
            <td>{{ pessoa?.endereco?.cep | cep }}</td>
            <td>{{ pessoa.dataNascimento | date:'dd/MM/yyyy' }}</td>
            <td>
              <span [class.ativo]="pessoa.ativo" [class.inativo]="!pessoa.ativo">
                {{ pessoa.ativo ? 'Ativo' : 'Inativo' }}
              </span>
            </td>
            <td>
              <button (click)="editar(pessoa.id)">Editar</button>
              <button *ngIf="pessoa.ativo" (click)="inativar(pessoa.id)">Inativar</button>
              <button *ngIf="!pessoa.ativo" (click)="ativar(pessoa.id)">Ativar</button>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="paginacao" *ngIf="resultado.pessoas.length > 0">
        <ng-container *ngIf="pageSize > 0 && resultado.total > pageSize">
          <button (click)="setPageIndex(pageIndex - 1)" [disabled]="pageIndex === 0">Anterior</button>
          <span>P√°gina {{ pageIndex + 1 }} de {{ math.ceil(resultado.total / pageSize) }}</span>
          <button (click)="setPageIndex(pageIndex + 1)" [disabled]="!resultado.hasMore">Pr√≥xima</button>
        </ng-container>
      </div>
    </ng-container>
    <ng-template #semRegistros>
      <div class="sem-registros">Nenhuma pessoa idosa cadastrada.</div>
    </ng-template>
  </ng-template>
</div>