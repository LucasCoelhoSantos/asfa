<app-main-menu></app-main-menu>

<div class="container-fluid py-4" *ngIf="pessoaIdosa$ | async as pessoa; else loading">
  <div class="card shadow-sm">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
      <h2 class="h5 mb-0 fw-bold text-primary">{{ pessoa.nome }}</h2>
      <div>
        <button type="button" class="btn btn-sm btn-outline-secondary me-2" (click)="voltar()">
          <i class="bi bi-arrow-left"></i> Voltar para a Lista
        </button>
        <a [routerLink]="['/pessoa-idosa', pessoa.id, 'editar']" class="btn btn-sm btn-primary">
          <i class="bi bi-pencil me-1"></i> Editar
        </a>
      </div>
    </div>

    <div class="card-body p-4">
      <section class="mb-4">
        <h3 class="h6 border-bottom pb-2 mb-3">Dados Pessoais</h3>
        <div class="row">
          <div class="col-md-4"><strong>CPF:</strong> {{ pessoa.cpf | cpf }}</div>
          <div class="col-md-4"><strong>RG:</strong> {{ pessoa.rg | rg }}</div>
          <div class="col-md-4"><strong>Órgão Emissor:</strong> {{ pessoa.orgaoEmissor }}</div>
          <div class="col-md-4"><strong>Data de Nascimento:</strong> {{ pessoa.dataNascimento | date:'dd/MM/yyyy' }}</div>
          <div class="col-md-4"><strong>Estado Civil:</strong> {{ pessoa.estadoCivil }}</div>
          <div class="col-md-4"><strong>Naturalidade:</strong> {{ pessoa.naturalidade || 'Não informado' }}</div>
          <div class="col-md-4"><strong>Religião:</strong> {{ pessoa.religiao || 'Não informado' }}</div>
          <div class="col-md-4"><strong>Status:</strong>
            <span class="badge" [ngClass]="{'bg-success': pessoa.ativo, 'bg-danger': !pessoa.ativo}">
              {{ pessoa.ativo ? 'Ativo' : 'Inativo' }}
            </span>
          </div>
        </div>
      </section>

      <section class="mb-4">
        <h3 class="h6 border-bottom pb-2 mb-3">Contato</h3>
        <div class="row">
          <div class="col-md-6"><strong>Telefone:</strong> {{ pessoa.telefone | telefone }}</div>
          <div class="col-md-6"><strong>E-mail:</strong> {{ pessoa.email || 'Não informado' }}</div>
        </div>
      </section>

      <section class="mb-4">
        <h3 class="h6 border-bottom pb-2 mb-3">Endereço</h3>
        <p>
          {{ pessoa.endereco.logradouro }}, {{ pessoa.endereco.numero }}<br>
          {{ pessoa.endereco.bairro }} - {{ pessoa.endereco.cidade }}/{{ pessoa.endereco.estado }}<br>
          CEP: {{ pessoa.endereco.cep | cep }}
        </p>
      </section>
      
      <section class="mb-4">
        <h3 class="h6 border-bottom pb-2 mb-3">Anexos</h3>
        <div *ngIf="pessoa.anexos && pessoa.anexos.length > 0; else semAnexos">
            <ul class="list-group">
                <li *ngFor="let anexo of pessoa.anexos" class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <i class="{{ categoriasAnexoInfo[anexo.categoria].icon }} me-2"></i>
                        <span>{{ anexo.nome }}</span>
                        <small class="text-muted ms-2">({{ categoriasAnexoInfo[anexo.categoria].label }})</small>
                    </div>
                    <a [href]="anexo.url" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-eye"></i> Visualizar
                    </a>
                </li>
            </ul>
        </div>
        <ng-template #semAnexos>
            <p class="text-muted">Nenhum anexo cadastrado.</p>
        </ng-template>
      </section>

    </div>
  </div>
</div>

<ng-template #loading>
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>
</ng-template>